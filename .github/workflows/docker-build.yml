name: Docker Build

on:
  push:
    branches: [ main, master, develop ]
    paths:
      - 'backend/**'
      - 'frontend/**'
      - 'Dockerfile*'
      - 'docker-compose*.yml'
      - '.dockerignore'
  pull_request:
    branches: [ main, master, develop ]
  workflow_dispatch:

jobs:
  docker-build:
    name: Build Docker Images
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
      
      - name: Build backend Docker image (if Dockerfile exists)
        id: build-backend
        continue-on-error: true
        run: |
          if [ -f "backend/Dockerfile" ] || [ -f "Dockerfile.backend" ]; then
            echo "Building backend Docker image..."
            docker build -t chat-app-backend:latest -f backend/Dockerfile ./backend 2>/dev/null || \
            docker build -t chat-app-backend:latest -f Dockerfile.backend ./backend 2>/dev/null || \
            echo "No backend Dockerfile found, skipping..."
          else
            echo "No backend Dockerfile found, skipping..."
          fi
      
      - name: Build frontend Docker image (if Dockerfile exists)
        id: build-frontend
        continue-on-error: true
        run: |
          if [ -f "frontend/Dockerfile" ] || [ -f "Dockerfile.frontend" ]; then
            echo "Building frontend Docker image..."
            docker build -t chat-app-frontend:latest -f frontend/Dockerfile ./frontend 2>/dev/null || \
            docker build -t chat-app-frontend:latest -f Dockerfile.frontend ./frontend 2>/dev/null || \
            echo "No frontend Dockerfile found, skipping..."
          else
            echo "No frontend Dockerfile found, skipping..."
          fi
      
      - name: Build summary
        run: |
          echo "Docker build workflow completed"
          echo "Note: This workflow will build Docker images when Dockerfiles are present"

